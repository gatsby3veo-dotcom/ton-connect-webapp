<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8" />
  <script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body { margin:0; font-family: Arial; background:#0f172a; color:#fff; }
    .wrap { padding:16px; }
    button { padding:12px 16px; font-size:16px; border-radius:10px; border:0; }
  </style>
</head>
<body>
  <div class="wrap">
    <h3>TON Connect</h3>

    <!-- –æ—Å—Ç–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä (–º–æ–∂–µ—Ç –±—ã—Ç—å –ø—É—Å—Ç—ã–º, —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ) -->
    <div id="ton-connect"></div>

    <!-- ‚úÖ —Ä–µ–∞–ª—å–Ω–∞—è –∫–ª–∏–∫–∞–±–µ–ª—å–Ω–∞—è –∫–Ω–æ–ø–∫–∞ -->
    <button id="connectBtn">üîó –ü–æ–¥–∫–ª—é—á–∏—Ç—å –∫–æ—à–µ–ª–µ–∫</button>

    <div id="status" style="margin-top:12px; word-break:break-all;"></div>
  </div>

  <script>
    const tg = window.Telegram.WebApp;
    tg.expand();

    const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
      manifestUrl: window.location.origin + '/tonconnect-manifest.json',
      buttonRootId: 'ton-connect'
    });

    let userInitiated = false;

    document.getElementById('connectBtn').addEventListener('click', async () => {
      userInitiated = true;
      await tonConnectUI.openModal();
    });

    tonConnectUI.onStatusChange(wallet => {
      if (wallet?.account?.address) {
        document.getElementById('status').textContent = "Address: " + wallet.account.address;

        // ‚úÖ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –∏ –∑–∞–∫—Ä—ã–≤–∞–µ–º –¢–û–õ–¨–ö–û –µ—Å–ª–∏ —é–∑–µ—Ä —Å–∞–º –Ω–∞–∂–∞–ª –∫–Ω–æ–ø–∫—É
        if (userInitiated) {
          tg.sendData(JSON.stringify({ wallet: wallet.account.address }));
          tg.close();
        }
      }
    });
  </script>
</body>
</html>
