<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>TONBOX</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>

<style>
:root{
  --bg:#0f1115;
  --card:#181a20;
  --cardSoft:#1f222a;
  --text:#ffffff;
  --muted:#9aa0aa;
  --blue:linear-gradient(135deg,#4da3ff,#3b82f6);
}

body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}

/* ===== TOP BAR ===== */

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:14px 16px;
  background:#0f1115;
}

.balance{
  display:flex;
  align-items:center;
  gap:8px;
  background:var(--cardSoft);
  padding:8px 12px;
  border-radius:14px;
}

.ton-icon{
  width:24px;
  height:24px;
  border-radius:50%;
  background:#2a2d36;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
}

.amount{
  font-weight:600;
  font-size:14px;
}

.plus{
  border:none;
  background:#2a2d36;
  color:white;
  width:22px;
  height:22px;
  border-radius:50%;
  cursor:pointer;
}

.avatar{
  width:40px;
  height:40px;
  border-radius:50%;
  object-fit:cover;
}

.wallet-btn{
  background:var(--blue);
  border:none;
  padding:10px 16px;
  border-radius:18px;
  font-weight:600;
  color:white;
  cursor:pointer;
}

/* ===== CARD ===== */

.wrap{
  padding:18px 16px;
  max-width:560px;
  margin:0 auto;
}

.card{
  background:var(--card);
  border-radius:18px;
  padding:16px;
}

.address{
  margin-top:12px;
  color:var(--muted);
  font-size:13px;
  display:none;
  word-break:break-all;
}
</style>
</head>

<body>

<div class="topbar">
  <div class="balance">
    <div class="ton-icon">T</div>
    <span class="amount">0.00</span>
    <button class="plus">+</button>
  </div>

  <img id="avatar" class="avatar" />

  <button id="walletBtn" class="wallet-btn">
    Кошелек
  </button>
</div>

<div class="wrap">
  <div class="card">
    <div style="font-weight:600;font-size:16px;">
      TON Wallet
    </div>
    <div id="walletAddr" class="address"></div>
  </div>
</div>

<script>
const tg = window.Telegram?.WebApp;
if(tg) tg.ready();

const user = tg?.initDataUnsafe?.user;
const avatar = document.getElementById("avatar");

if(user?.photo_url){
  avatar.src = user.photo_url;
}

/* ===== TON CONNECT ===== */

const MANIFEST_URL = "https://ton-connect-webapp.vercel.app/tonconnect-manifest.json";

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: MANIFEST_URL
});

const walletBtn = document.getElementById("walletBtn");
const walletAddr = document.getElementById("walletAddr");

function shorten(addr){
  if(!addr) return "";
  return addr.slice(0,5)+"******"+addr.slice(-5);
}

function updateUI(wallet){
  if(wallet?.account?.address){
    walletBtn.textContent = "Отключить";
    walletAddr.style.display = "block";
    walletAddr.textContent = shorten(wallet.account.address);
  }else{
    walletBtn.textContent = "Кошелек";
    walletAddr.style.display = "none";
  }
}

walletBtn.addEventListener("click", async ()=>{
  if(tonConnectUI.wallet){
    await tonConnectUI.disconnect();
  }else{
    await tonConnectUI.connectWallet();
  }
});

tonConnectUI.onStatusChange(wallet=>{
  updateUI(wallet);
});

updateUI(tonConnectUI.wallet);
</script>

</body>
</html>
