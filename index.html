<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>BattleROLL</title>

<script src="https://telegram.org/js/telegram-web-app.js"></script>
<script src="https://unpkg.com/@tonconnect/ui@latest/dist/tonconnect-ui.min.js"></script>
<script src="https://unpkg.com/tonweb@latest/dist/tonweb.js"></script>

<style>
:root{
  --bg:#0b0f17;
  --text:#ffffff;
  --muted:#8e97a8;
  --blue:linear-gradient(135deg,#4da3ff,#3b82f6);
  --green:linear-gradient(135deg,#22d3a6,#06b6d4);
  --purple:linear-gradient(135deg,#8b5cf6,#6366f1);
}

body{
  margin:0;
  background:radial-gradient(circle at top,#0f1a2a 0%,#0b0f17 60%);
  color:var(--text);
  font-family:system-ui,-apple-system,Segoe UI,Roboto;
}

.top-wrapper{
  padding:18px 16px 24px;
}

/* ===== VIEWERS ===== */

.viewers{
  display:flex;
  justify-content:center;
  align-items:center;
  gap:6px;
  font-size:13px;
  color:var(--muted);
  margin-bottom:16px;
}

.viewers svg{
  width:16px;
  height:16px;
}

/* ===== TOPBAR ===== */

.topbar{
  display:flex;
  align-items:center;
  justify-content:space-between;
}

.balance{
  display:flex;
  align-items:center;
  gap:8px;
  background:#161b25;
  padding:8px 12px;
  border-radius:14px;
}

.ton-icon{
  width:24px;
  height:24px;
  border-radius:50%;
  background:#2b3142;
  display:flex;
  align-items:center;
  justify-content:center;
  font-size:13px;
}

.amount{
  font-weight:600;
  font-size:14px;
}

.plus{
  border:none;
  background:#2b3142;
  color:white;
  width:22px;
  height:22px;
  border-radius:50%;
  cursor:pointer;
}

.avatar{
  width:42px;
  height:42px;
  border-radius:50%;
  object-fit:cover;
}

.right-block{
  display:flex;
  flex-direction:column;
  align-items:flex-end;
}

.wallet-btn{
  background:var(--blue);
  border:none;
  padding:10px 18px;
  border-radius:18px;
  font-weight:600;
  color:white;
  cursor:pointer;
}

.wallet-address{
  margin-top:6px;
  font-size:12px;
  color:var(--muted);
  display:none;
}

/* ===== SEASONS ===== */

.seasons{
  margin-top:26px;
  display:flex;
  gap:14px;
}

.season-card{
  flex:1;
  padding:18px;
  border-radius:20px;
  cursor:pointer;
  position:relative;
  transition:0.3s;
  overflow:hidden;
  color:white;
}

.season1{
  background:var(--green);
}

.season2{
  background:var(--purple);
}

.season-card:hover{
  transform:translateY(-3px);
}

/* ACTIVE GLOW */

.season-card.active{
  box-shadow:
    0 0 20px rgba(34,211,166,0.5),
    0 0 40px rgba(34,211,166,0.25);
  animation:pulse 2s infinite;
}

@keyframes pulse{
  0%{box-shadow:0 0 15px rgba(34,211,166,0.3);}
  50%{box-shadow:0 0 35px rgba(34,211,166,0.7);}
  100%{box-shadow:0 0 15px rgba(34,211,166,0.3);}
}

.season-title{
  font-size:16px;
  font-weight:700;
}

.season-sub{
  font-size:12px;
  margin-top:6px;
  opacity:0.9;
}
</style>
</head>

<body>

<div class="top-wrapper">

  <!-- VIEWERS -->
  <div class="viewers">
    <svg viewBox="0 0 24 24" fill="currentColor">
      <path d="M12 5C5 5 2 12 2 12s3 7 10 7 10-7 10-7-3-7-10-7zm0 11a4 4 0 110-8 4 4 0 010 8z"/>
    </svg>
    <span id="viewerCount">Watching: 1</span>
  </div>

  <!-- TOPBAR -->
  <div class="topbar">
    <div class="balance">
      <div class="ton-icon">T</div>
      <span class="amount">0.00</span>
      <button class="plus">+</button>
    </div>

    <img id="avatar" class="avatar"/>

    <div class="right-block">
      <button id="walletBtn" class="wallet-btn">
        Wallet
      </button>
      <div id="walletAddr" class="wallet-address"></div>
    </div>
  </div>

  <!-- SEASONS -->
  <div class="seasons">
    <div class="season-card season1 active" id="season1">
      <div class="season-title">Season 1</div>
      <div class="season-sub">Live leaderboard</div>
    </div>

    <div class="season-card season2" id="season2">
      <div class="season-title">Season 2</div>
      <div class="season-sub">Coming soon</div>
    </div>
  </div>

</div>

<script>
const tg = window.Telegram?.WebApp;
if(tg) tg.ready();

/* ===== SIMPLE REALTIME VIEWERS (DEMO LOGIC) ===== */

const viewerEl = document.getElementById("viewerCount");

function updateViewers(){
  let viewers = parseInt(localStorage.getItem("viewers") || "0");
  viewers += 1;
  localStorage.setItem("viewers", viewers);
  viewerEl.textContent = "Watching: " + viewers;
}
updateViewers();

/* ===== SEASON SWITCH ===== */

document.getElementById("season1").onclick = () => {
  season1.classList.add("active");
  season2.classList.remove("active");
};

document.getElementById("season2").onclick = () => {
  season2.classList.add("active");
  season1.classList.remove("active");
};

/* ===== TON CONNECT ===== */

const MANIFEST_URL = "https://ton-connect-webapp.vercel.app/tonconnect-manifest.json";

const tonConnectUI = new TON_CONNECT_UI.TonConnectUI({
  manifestUrl: MANIFEST_URL
});

const walletBtn = document.getElementById("walletBtn");
const walletAddr = document.getElementById("walletAddr");

function toFriendly(raw){
  try{
    const address = new TonWeb.utils.Address(raw);
    return address.toString(true, true, false);
  }catch{
    return raw;
  }
}

function shorten(addr){
  return addr.slice(0,4)+"******"+addr.slice(-4);
}

function updateUI(wallet){
  if(wallet?.account?.address){
    const friendly = toFriendly(wallet.account.address);
    walletBtn.textContent = "Disconnect";
    walletAddr.style.display = "block";
    walletAddr.textContent = shorten(friendly);
  }else{
    walletBtn.textContent = "Wallet";
    walletAddr.style.display = "none";
  }
}

walletBtn.onclick = async ()=>{
  if(tonConnectUI.wallet){
    await tonConnectUI.disconnect();
  }else{
    await tonConnectUI.connectWallet();
  }
};

tonConnectUI.onStatusChange(updateUI);
updateUI(tonConnectUI.wallet);
</script>

</body>
</html>
